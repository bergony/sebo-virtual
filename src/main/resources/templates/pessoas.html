<!DOCTYPE HTML>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Selo Virtual</title>

    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/4.0.0-2/css/bootstrap.min.css} "/>
    <link rel="stylesheet" th:href="@{/css/main.css}"/>

</head>

<body>

<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
    <a class="navbar-brand" th:href="@{/home}">SeloVirtual.com</a>
    <div class="col-lg-10 col-sm-12 d-flex flex-sm-row-reverse" >
        <div>
            <form th:action="@{/appVoltar(voltar=${voltar})}" method="POST">
                <input class="btn-secondary" type="submit" value="Voltar"/>
            </form>

        </div>
    </div>
</nav>

    <div class="row mt-5  ml-2 mr-2">
        <div class="card rounded mt-5 py-5 px-md-5 mx-auto shadow-5-strong  align-self-center" style="
        background: hsla(0, 100%, 100%, 1);
        backdrop-filter: blur(30px);
        width: 60rem;">
            <div class="starter-template">
                <h2>
                    <span th:text="'Bem vindo' "></span>
                </h2>
                <h1>A Forma Mais Fácil de Trocar Livros </h1>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="card rounded mt-3 py-5 px-md-5 pb-3 mx-auto shadow-5-strong  align-self-center" style="
        background: hsla(0, 100%, 100%, 1);
        backdrop-filter: blur(30px);
        width: 60rem;
        ">
            <div class="card-body">
                <tr th:each="erro : ${erros}">
                    <td >
                        <p class="alert alert-danger" th:text="${erro}" ></p>
                    </td>
                    <br/>
                </tr>
                <tr th:each="sucesso : ${sucessos}">
                    <td >
                        <p class="alert alert-success" th:text="${sucesso}" ></p>
                    </td>
                    <br/>
                </tr>
                <form method="post" th:action="@{/pessoas/}" th:object="${pessoa}" class="col card p-3 mb-5">
                    <div class="form-group row">
                        <div class="col-lg-3 col-sm-12">
                            <label for="nomeCompleto">Nome Completo</label>
                            <input id="nomeCompleto" placeholder="Nome Completo" required type="text"
                                   th:field="*{nomeCompleto}"
                                   class="form-control"/>
                        </div>
                        <div class="col-lg-3 col-sm-12">
                            <label for="email">E-mail</label>
                            <input id="email" placeholder="E-mail" required type="text"
                                   th:field="*{email}"
                                   class="form-control"/>
                        </div>
                        <div class="col-lg-3 col-sm-12">

                            <label for="dataNascimento">Data Nascimento</label>
                            <input id="dataNascimento" placeholder="Data Nascimento" required type="date"
                                   th:field="*{dataNascimento}"
                                   class="form-control"/>
                        </div>
                        <div class="col-lg-3 col-sm-12">
                            <label for="Usuário">Usuário</label>
                            <input id="Usuário" placeholder="Usuário" required type="text" th:field="*{username}"
                                   class="form-control"/>
                        </div>
                        <div class="col-lg-3 col-sm-12">
                            <label for="Senha">Senha</label>
                            <input id="Senha" placeholder="Senha" required type="text" th:field="*{password}"
                                   class="form-control"/>
                        </div>
                        <div class="col-lg-3 col-sm-12">
                            <label for="cpf">CPF</label>
                            <input id="cpf" placeholder="CPF" required type="text" th:field="*{cpf}"
                                   pattern="\d{3}\.?\d{3}\.?\d{3}-?\d{2}"
                                   title="Digite um CPF no formato: xxx.xxx.xxx-xx ou xxxxxxxxxxx"
                                   class="form-control"/>
                        </div>
                        <div class="col-lg-3 col-sm-12">
                            <label for="telefone">Telefone</label>
                            <input id="telefone" placeholder="Telefone" required type="text" th:field="*{telefone.numero}"
                                   class="form-control"/>
                        </div>


                        <div class="col-lg-3 col-sm-12">
                            <label for="cep">CEP</label>
                            <input id="cep" placeholder="CEP" required type="text" th:field="*{endereco.cep}"
                                   class="form-control"/>
                        </div>

                        <div class="col-lg-3 col-sm-12">
                            <label for="cidade">Cidade</label>
                            <input id="cidade" placeholder="Cidade" required type="text" th:field="*{endereco.cidade}"
                                   class="form-control"/>
                        </div>

                        <div class="col-lg-3 col-sm-12">
                            <label for="numero">Número</label>
                            <input id="numero" placeholder="Número" required type="text" th:field="*{endereco.numero}"
                                   class="form-control"/>
                        </div>

                        <div class="col-lg-3 col-sm-12">
                            <label for="logradouro">Logradouro</label>
                            <input id="logradouro" placeholder="Logradouro" required type="text" th:field="*{endereco.logradouro}"
                                   class="form-control"/>
                        </div>

                        <div class="col-lg-3 col-sm-12">
                            <label for="bairro">Bairro</label>
                            <input id="bairro" placeholder="Bairro" required type="text" th:field="*{endereco.bairro}"
                                   class="form-control"/>
                        </div>

                        <div class="col-lg-3 col-sm-12">
                            <label for="estado">UF</label>
                            <input id="estado" placeholder="UF" required type="text" th:field="*{endereco.estado}"
                                   class="form-control"/>
                        </div>

                        <div class="col-lg-3 col-sm-12" th:hidden="true">
                            <label for="id">ID</label>
                            <input id="id" placeholder="id" required type="text" th:field="*{id}"
                                   class="form-control"/>
                        </div>
                        <div class="col-lg-3 col-sm-12 mt-4" th:if="${usuarioLogando != null and usuarioLogando.isAdmin()}">
                            <label for="admin">Administrador</label>
                            <input id="admin" placeholder="admin" type="checkbox" th:field="*{admin}" data-toggle="switch"/>
                        </div>

                    </div>
                        <div class="col-12 m-2" th:if="${usuarioLogando == null}">
                            <input type="submit" class="btn btn-primary" value="Cadastre-se">
                        </div>
                    <div class="col-12 m-2" th:if="${usuarioLogando != null and usuarioLogando.isAdmin()}">
                        <input type="submit" class="btn btn-primary" value="Editar Usuário">
                    </div>
                </form>

            </div>
        </div>
    </div>
<!-- /.container -->

<script>

    var cep = document.getElementById("cep");

    cep.addEventListener("focusout", function(){
        var novoCep = cep.value.replace('-', '');

        console.log(novoCep);

        if(novoCep.length != 8){
            limparCampos();
            return false;
        }

        let url = 'https://viacep.com.br/ws/' + novoCep + '/json';
        let xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4) {
                if (xhr.status = 200)
                    console.log(JSON.parse(xhr.responseText));
                    preencheCampos(JSON.parse(xhr.responseText));
            }
        }
        xhr.send();
    })

    function limparCampos(){
        document.getElementById('logradouro').value=("");
        document.getElementById('bairro').value=("")
        document.getElementById('estado').value=("")
        document.getElementById('cidade').value=("")

    }

    function preencheCampos(conteudo){
        if(!("erro" in conteudo)){
            limparCampos();
            if(conteudo.logradouro != '') document.getElementById('logradouro').value=(conteudo.logradouro);
            if(conteudo.bairro != '') document.getElementById('bairro').value=(conteudo.bairro);
            if(conteudo.uf != '') document.getElementById('estado').value=(conteudo.uf);
            if(conteudo.localidade != '') document.getElementById('cidade').value=(conteudo.localidade);


        }else{
            limparCampos();
        }
    }
</script>


<script th:src="@{/webjars/jquery/3.0.0/jquery.min.js}"></script>
<script th:src="@{/webjars/popper.js/1.12.9-1/umd/popper.min.js}"></script>
<script th:src="@{/webjars/bootstrap/4.0.0-2/js/bootstrap.min.js}"></script>
</body>
</html>